import{k as u,j as e,r as h,d as v,I as r,M as E,t as n,n as N,l as b,N as C,q as P,O as I,H as B,Q as x,o as A,h as D,P as L,K as T,L as p,D as y,E as $,s as q,e as M,S as U}from"./index-voyYtVJV.js";import{P as g}from"./profile_thing-CVR4M414.js";import{D as W}from"./dropdown-DIpuSnKB.js";async function F(){if("serviceWorker"in navigator&&"PushManager"in window)try{const o=await navigator.serviceWorker.getRegistration("/sw.js");o&&await o.unregister();const l=await navigator.serviceWorker.register("/sw.js",{type:"module"});console.log("Service Worker registered");const i=await l.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:O("BLZ5Wvz_DHCfREAWZ-WAYlPYs-QoqMAjlmKhAEhGUwLeAPjX036PLAzeJiSCjPdet3G6fBqlYkUB-xwqCD08Zt0")});console.log("Got subscription:",i),await fetch(`${u}/subscribe`,{method:"POST",body:JSON.stringify({subscription:i,token:localStorage.getItem("token")}),headers:{"Content-Type":"application/json"}}),console.log("Subscription sent to server ✅")}catch(o){console.error("Push subscription error:",o)}else console.warn("Push messaging is not supported in this browser :(")}function O(o){const l="=".repeat((4-o.length%4)%4),i=(o+l).replace(/\-/g,"+").replace(/_/g,"/"),m=atob(i);return new Uint8Array([...m].map(f=>f.charCodeAt(0)))}function R({src:o="",onClick:l,text:i=""}){return e.jsxs("div",{className:"SquareImgBtn",onClick:l,children:[o&&e.jsx("img",{src:o,alt:"img",onError:m=>m.currentTarget.src="./logo512.png"}),i&&e.jsx("p",{children:i})]})}function Y(){const[o,l]=h.useState([]),[i,m]=h.useState(null);function f(){y("image",!1,s=>{const a=s[0];if(!a)return;const c=new FormData;c.append("avatar",a),fetch(`${u}/upload-avatar`,{method:"POST",headers:{Authorization:"Bearer "+localStorage.getItem("token")},body:c}).then(t=>t.json()).then(t=>{console.log("Avatar loaded:",t.url);const d=document.getElementById("avatar_settings");setTimeout(()=>{d.style.scale="0",setTimeout(()=>{d.src="",setTimeout(()=>{d.src=`${u}/avatars/${localStorage.getItem("id")}.webp?t=${Date.now()}`,d.style.scale="1"},10)},500)},100)}).catch(t=>{console.error("Error loading avatar:",t)})})}function _(){document.getElementById("left_panel").classList.add("show"),document.getElementById("right_panel").style.filter="blur(1px)",document.getElementById("menu_button").classList.add("hide")}function j(s){document.querySelectorAll(".SettingsScreen").forEach(t=>t.classList.add("hide"));const c=document.querySelector(`.${s}`);c.classList.remove("hide"),c.classList.add("show"),document.getElementById("left_panel").classList.remove("show"),document.getElementById("right_panel").style.filter="",document.getElementById("menu_button").classList.remove("hide")}function k(){y("image",!1,async s=>{const a=s[0];if(!a)return;if(i)i.set("emoji",a),m(i);else{const S=new FormData;S.append("emoji",a),m(S)}const c=await U(a,128),t=URL.createObjectURL(c),d=document.querySelector(".SelectEmojiImg");d.src=t})}function w(){const s=document.getElementById("emoji_name_input"),a=s.value.trim();if(!$(a,"username",1,64)){s.classList.add("error"),setTimeout(()=>{s.classList.remove("error")},1e3);return}if(!i){q(n("upload_image_first"));return}const c=i;c.append("name",a),fetch(`${u}/upload-emoji`,{method:"POST",headers:{Authorization:"Bearer "+localStorage.getItem("token")},body:c}).then(t=>t.json()).then(t=>{console.log("Emoji uploaded:",t),v().emit("getCustomEmojis",{}),s.value="",document.querySelector(".SelectEmojiImg").src="/assets/select.svg",m(null),M("add-emoji")}).catch(t=>console.error("Error uploading emoji:",t))}return h.useEffect(()=>{setTimeout(()=>{const s=document.getElementById("menu_button");window.matchMedia("(orientation: portrait)").matches&&s.click()},100)},[]),h.useEffect(()=>{const s=v();return s.on("customEmojis",a=>{setTimeout(()=>l(a.emojis),100)}),s.emit("getCustomEmojis",{}),()=>{s.off("customEmojis")}}),e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"App",id:"app",children:[e.jsx("button",{className:"BackButton",id:"menu_button",onClick:_,children:e.jsx(r,{icon:E})}),e.jsx("div",{className:"LeftPanel",id:"left_panel",children:e.jsxs("div",{className:"SettingsPanel",children:[e.jsxs(g,{text:n("back"),image:!1,onClick:()=>{N("/")},children:[" ",e.jsx(r,{icon:E})," "]}),e.jsxs(g,{text:n("general"),image:!1,onClick:()=>{j("GeneralSettings")},children:[" ",e.jsx(r,{icon:b})," "]}),e.jsxs(g,{text:n("profile"),image:!1,onClick:()=>{j("ProfileSettings")},children:[" ",e.jsx(r,{icon:C})," "]}),e.jsxs(g,{text:n("messages"),image:!1,onClick:()=>{j("MessagesSettings")},children:[" ",e.jsx(r,{icon:P})," "]}),e.jsxs(g,{text:n("emojis"),image:!1,onClick:()=>{j("EmojiSettings")},children:[" ",e.jsx(r,{icon:I})," "]})]})}),e.jsx("div",{className:"RightPanel Settings",id:"right_panel",children:e.jsxs("div",{className:"SettingsScreens",children:[e.jsx("div",{className:"SettingsScreen GeneralSettings hide",children:e.jsxs("div",{className:"Thing",children:[" ",e.jsxs("div",{className:"EditDiv",onClick:s=>B("lang",s.currentTarget),children:[e.jsx("p",{style:{width:"100%",textAlign:"center",display:"flex",justifyContent:"center",alignItems:"center"},children:`${n("language")}: ${n("current_lang")}`}),e.jsx(r,{icon:x,className:"pencil"})]})]})}),e.jsx("div",{className:"SettingsScreen ProfileSettings hide",children:e.jsxs("div",{className:"Profile",children:[e.jsxs("div",{className:"EditDiv",onClick:f,children:[e.jsx("img",{src:`${u}/avatars/${localStorage.getItem("id")}.webp`,onError:s=>s.currentTarget.src="./logo512.png",className:"AvatarSettings",id:"avatar_settings"}),e.jsx(r,{icon:x,className:"pencil"})]}),e.jsx("p",{style:{fontWeight:"bold",fontSize:"28px"},children:localStorage.getItem("username")})]})}),e.jsx("div",{className:"SettingsScreen MessagesSettings hide",children:e.jsx("div",{className:"Thing",children:e.jsx(g,{text:n("subscribe_to_msges"),image:!1,animation:!1,onClick:F})})}),e.jsx("div",{className:"SettingsScreen EmptySettings show",children:e.jsx(r,{icon:b,style:{color:"#aaa",fontSize:"24vh",filter:"blur(5px)"}})}),e.jsx("div",{className:"SettingsScreen EmojiSettings hide",children:e.jsxs("div",{className:"CurrentEmojis",children:[o.map(s=>e.jsx(R,{src:`${u}/emojis/${s.id}.webp`,onClick:()=>{},text:s.name},s.id)),e.jsxs("button",{id:"add_emoji_btn",onClick:()=>A("add-emoji"),children:[e.jsx(r,{icon:D}),n("add_emoji")]})]})})]})})]}),e.jsx(L,{title:n("add_emoji"),name:"add-emoji",children:e.jsxs("div",{className:"AddEmojiPopupContent",children:[e.jsxs("div",{className:"EditDiv",style:{marginBottom:"10px",width:"fit-content"},onClick:k,children:[e.jsx("img",{src:"/assets/select.svg",className:"SelectEmojiImg"}),e.jsx(r,{icon:x,className:"pencil"})]}),e.jsx("input",{type:"text",className:"EmojiNameInput",placeholder:n("emoji_name"),id:"emoji_name_input"}),e.jsx("button",{className:"SubmitEmojiBtn",onClick:w,children:n("submit")})]})}),e.jsxs(W,{name:"lang",children:[e.jsxs("div",{className:"noanim",children:[e.jsx(r,{icon:T}),n("select_language")]}),e.jsx("div",{onClick:()=>p(""),children:e.jsx("p",{children:n("auto_lang")})}),e.jsx("div",{onClick:()=>p("en"),children:e.jsx("p",{children:"English"})}),e.jsx("div",{onClick:()=>p("ru"),children:e.jsx("p",{children:"Русский"})}),e.jsx("div",{onClick:()=>p("uk"),children:e.jsx("p",{children:"Українська"})})]})]})}export{Y as default};
