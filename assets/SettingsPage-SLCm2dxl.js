import{e as h,j as e,r as j,d as k,I as n,N as b,t,p as A,n as C,O as D,w as L,Q as v,S as $,J as S,T as _,m as W,U as q,o as M,l as U,P as F,L as O,M as p,V as w,W as x,X as N,E as I,F as R,s as z,h as G,Y}from"./index-CLhpheLR.js";import{P as l}from"./profile_thing-_KqT8o7h.js";import{D as E}from"./dropdown-Ddk3uM8L.js";async function J(){if("serviceWorker"in navigator&&"PushManager"in window)try{const r=await navigator.serviceWorker.getRegistration("/sw.js");r&&await r.unregister();const m=await navigator.serviceWorker.register("/sw.js",{type:"module"});console.log("Service Worker registered");const o=await m.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:Z("BLZ5Wvz_DHCfREAWZ-WAYlPYs-QoqMAjlmKhAEhGUwLeAPjX036PLAzeJiSCjPdet3G6fBqlYkUB-xwqCD08Zt0")});console.log("Got subscription:",o),await fetch(`${h}/subscribe`,{method:"POST",body:JSON.stringify({subscription:o,token:localStorage.getItem("token")}),headers:{"Content-Type":"application/json"}}),console.log("Subscription sent to server ✅")}catch(r){console.error("Push subscription error:",r)}else console.warn("Push messaging is not supported in this browser :(")}function Z(r){const m="=".repeat((4-r.length%4)%4),o=(r+m).replace(/\-/g,"+").replace(/_/g,"/"),d=atob(o);return new Uint8Array([...d].map(f=>f.charCodeAt(0)))}function K({src:r="",onClick:m,text:o=""}){return e.jsxs("div",{className:"SquareImgBtn",onClick:m,children:[r&&e.jsx("img",{src:r,alt:"img",onError:d=>d.currentTarget.src="./logo512.png"}),o&&e.jsx("p",{children:o})]})}function H(){const[r,m]=j.useState([]),[o,d]=j.useState(null);function f(){I("image",!1,s=>{const a=s[0];if(!a)return;const c=new FormData;c.append("avatar",a),fetch(`${h}/upload-avatar`,{method:"POST",headers:{Authorization:"Bearer "+localStorage.getItem("token")},body:c}).then(i=>i.json()).then(i=>{console.log("Avatar loaded:",i.url);const g=document.getElementById("avatar_settings");setTimeout(()=>{g.style.scale="0",setTimeout(()=>{g.src="",setTimeout(()=>{g.src=`${h}/avatars/${localStorage.getItem("id")}.webp?t=${Date.now()}`,g.style.scale="1"},10)},500)},100)}).catch(i=>{console.error("Error loading avatar:",i)})})}function P(){document.getElementById("left_panel").classList.add("show"),document.getElementById("right_panel").style.filter="blur(1px)",document.getElementById("menu_button").classList.add("hide")}function u(s){document.querySelectorAll(".SettingsScreen").forEach(i=>i.classList.add("hide"));const c=document.querySelector(`.${s}`);c.classList.remove("hide"),c.classList.add("show"),document.getElementById("left_panel").classList.remove("show"),document.getElementById("right_panel").style.filter="",document.getElementById("menu_button").classList.remove("hide")}function B(){I("image",!1,async s=>{const a=s[0];if(!a)return;if(o)o.set("emoji",a),d(o);else{const y=new FormData;y.append("emoji",a),d(y)}const c=await Y(a,128),i=URL.createObjectURL(c),g=document.querySelector(".SelectEmojiImg");g.src=i})}function T(){const s=document.getElementById("emoji_name_input"),a=s.value.trim();if(!R(a,"username",1,64)){s.classList.add("error"),setTimeout(()=>{s.classList.remove("error")},1e3);return}if(!o){z(t("upload_image_first"));return}const c=o;c.append("name",a),fetch(`${h}/upload-emoji`,{method:"POST",headers:{Authorization:"Bearer "+localStorage.getItem("token")},body:c}).then(i=>i.json()).then(i=>{console.log("Emoji uploaded:",i),k().emit("getCustomEmojis",{}),s.value="",document.querySelector(".SelectEmojiImg").src="/assets/select.svg",d(null),G("add-emoji")}).catch(i=>console.error("Error uploading emoji:",i))}return j.useEffect(()=>{setTimeout(()=>{const s=document.getElementById("menu_button");window.matchMedia("(orientation: portrait)").matches&&s.click()},100)},[]),j.useEffect(()=>{const s=k();return s.on("customEmojis",a=>{setTimeout(()=>m(a.emojis),100)}),s.emit("getCustomEmojis",{}),()=>{s.off("customEmojis")}}),e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"App",id:"app",children:[e.jsx("button",{className:"BackButton",id:"menu_button",onClick:P,children:e.jsx(n,{icon:b})}),e.jsx("div",{className:"LeftPanel",id:"left_panel",children:e.jsxs("div",{className:"SettingsPanel",children:[e.jsx(l,{text:t("back"),image:!1,onClick:()=>{A("/")},children:e.jsx(n,{icon:b})}),e.jsxs(l,{text:t("general"),image:!1,onClick:()=>{u("GeneralSettings")},children:[" ",e.jsx(n,{icon:C})," "]}),e.jsxs(l,{text:t("profile"),image:!1,onClick:()=>{u("ProfileSettings")},children:[" ",e.jsx(n,{icon:D})," "]}),e.jsxs(l,{text:t("messages"),image:!1,onClick:()=>{u("MessagesSettings")},children:[" ",e.jsx(n,{icon:L})," "]}),e.jsxs(l,{text:t("appearance"),image:!1,onClick:()=>{u("AppearanceSettings")},children:[" ",e.jsx(n,{icon:v})," "]}),e.jsxs(l,{text:t("emojis"),image:!1,onClick:()=>{u("EmojiSettings")},children:[" ",e.jsx(n,{icon:$})," "]})]})}),e.jsx("div",{className:"RightPanel Settings",id:"right_panel",children:e.jsxs("div",{className:"SettingsScreens",children:[e.jsx("div",{className:"SettingsScreen GeneralSettings hide",children:e.jsx("div",{className:"Thing",children:e.jsxs("div",{className:"EditDiv",onClick:s=>S("lang",s.currentTarget),children:[e.jsx("p",{style:{width:"100%",textAlign:"center",display:"flex",justifyContent:"center",alignItems:"center"},children:`${t("language")}: ${t("current_lang")}`}),e.jsx(n,{icon:_,className:"pencil"})]})})}),e.jsx("div",{className:"SettingsScreen AppearanceSettings hide",children:e.jsxs("div",{className:"Thing",children:[e.jsx(l,{image:!1,animation:!1,text:`${t("theme")}: ${t((localStorage.getItem("theme")||"default")+"_theme")}`,onClick:(s,a)=>S("theme",a.target)}),localStorage.getItem("theme")==="material"&&e.jsxs("div",{children:[e.jsx(l,{image:!1,animation:!1,text:`${t("material_scheme")}: ${t((localStorage.getItem("material_scheme")||"default")+"_scheme")}`,onClick:(s,a)=>S("scheme",a.target)}),e.jsxs(W.div,{initial:{opacity:0,x:250},animate:{opacity:1,x:0},children:[e.jsx("p",{style:{color:"var(--secondary)",fontWeight:"500"},children:t("material_color")}),e.jsx("input",{type:"color",value:localStorage.getItem("material_color")||"#0000ff",onChange:s=>{localStorage.setItem("material_color",s.target.value),q()}})]})]})]})}),e.jsx("div",{className:"SettingsScreen ProfileSettings hide",children:e.jsxs("div",{className:"Profile",children:[e.jsxs("div",{className:"EditDiv",onClick:f,children:[e.jsx("img",{src:`${h}/avatars/${localStorage.getItem("id")}.webp`,onError:s=>s.currentTarget.src="./logo512.png",className:"AvatarSettings",id:"avatar_settings"}),e.jsx(n,{icon:_,className:"pencil"})]}),e.jsx("p",{style:{fontWeight:"bold",fontSize:"28px"},children:localStorage.getItem("username")})]})}),e.jsx("div",{className:"SettingsScreen MessagesSettings hide",children:e.jsx("div",{className:"Thing",children:e.jsx(l,{text:t("subscribe_to_msges"),image:!1,animation:!1,onClick:J})})}),e.jsx("div",{className:"SettingsScreen EmptySettings show",children:e.jsx(n,{icon:C,style:{color:"#aaa",fontSize:"24vh",filter:"blur(5px)"}})}),e.jsx("div",{className:"SettingsScreen EmojiSettings hide",children:e.jsxs("div",{className:"CurrentEmojis",children:[r.map(s=>e.jsx(K,{src:`${h}/emojis/${s.id}.webp`,onClick:()=>{},text:s.name},s.id)),e.jsxs("button",{id:"add_emoji_btn",onClick:()=>M("add-emoji"),children:[e.jsx(n,{icon:U}),t("add_emoji")]})]})})]})})]}),e.jsx(F,{title:t("add_emoji"),name:"add-emoji",children:e.jsxs("div",{className:"AddEmojiPopupContent",children:[e.jsxs("div",{className:"EditDiv",style:{marginBottom:"10px",width:"fit-content"},onClick:B,children:[e.jsx("img",{src:"/assets/select.svg",className:"SelectEmojiImg"}),e.jsx(n,{icon:_,className:"pencil"})]}),e.jsx("input",{type:"text",className:"EmojiNameInput",placeholder:t("emoji_name"),id:"emoji_name_input"}),e.jsx("button",{className:"SubmitEmojiBtn",onClick:T,children:t("submit")})]})}),e.jsxs(E,{name:"lang",children:[e.jsxs("div",{className:"noanim",children:[e.jsx(n,{icon:O}),t("select_language")]}),e.jsx("div",{onClick:()=>p(""),children:e.jsx("p",{children:t("auto_lang")})}),e.jsx("div",{onClick:()=>p("en"),children:e.jsx("p",{children:"English"})}),e.jsx("div",{onClick:()=>p("ru"),children:e.jsx("p",{children:"Русский"})}),e.jsx("div",{onClick:()=>p("uk"),children:e.jsx("p",{children:"Українська"})})]}),e.jsxs(E,{name:"theme",children:[e.jsxs("div",{className:"noanim",children:[e.jsx(n,{icon:v}),t("select_theme")]}),e.jsx("div",{onClick:()=>{w("midnight"),x("theme")},children:e.jsx("p",{children:t("midnight_theme")})}),e.jsx("div",{onClick:()=>{w("material"),x("theme")},children:e.jsx("p",{children:t("material_theme")})})]}),e.jsxs(E,{name:"scheme",children:[e.jsxs("div",{className:"noanim",children:[e.jsx(n,{icon:v}),t("select_scheme")]}),e.jsx("div",{onClick:()=>{N("light"),x("scheme")},children:e.jsx("p",{children:t("light_scheme")})}),e.jsx("div",{onClick:()=>{N("dark"),x("scheme")},children:e.jsx("p",{children:t("dark_scheme")})})]})]})}export{H as default};
