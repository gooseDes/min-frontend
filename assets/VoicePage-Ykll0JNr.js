import{r as d,d as u,j as r}from"./index-Df3mUFhv.js";function g(){const[f,l]=d.useState(!1);return d.useEffect(()=>{if(f)return;l(!0);const o=u();o.on("turnUrls",n=>{navigator.mediaDevices.getUserMedia({audio:!0}).then(c=>{const t=new RTCPeerConnection({iceServers:n.urls});c.getTracks().forEach(e=>t.addTrack(e,c));const s=document.getElementById("remoteAudio");t.ontrack=e=>{s.srcObject!==e.streams[0]&&(s.srcObject=e.streams[0])},t.onicecandidate=e=>{e.candidate&&o.emit("voiceAction",{chat:1,action:"candidate",candidate:e.candidate})},o.on("voiceAction",async e=>{if(typeof e=="string"&&(e=JSON.parse(e)),console.log("voiceAction:",e),e.action==="offer"){await t.setRemoteDescription(e.offer);const i=await t.createAnswer();await t.setLocalDescription(i),o.emit("voiceAction",{chat:1,action:"answer",answer:i})}else if(e.action==="answer")await t.setRemoteDescription(e.answer);else if(e.action==="candidate")try{await t.addIceCandidate(e.candidate)}catch(i){console.error("Error adding ICE candidate:",i)}}),o.emit("joinVoice",{chat:1}),o.on("joinedVoice",e=>{console.log("joinedVoice:",e),e.role==="offer"&&o.on("userJoined",async i=>{if(console.log("userJoined:",i),i.user!==o.id){const a=await t.createOffer();await t.setLocalDescription(a),o.emit("voiceAction",{chat:1,action:"offer",offer:a})}})})}).catch(c=>{console.error("Error getting user media:",c)})}),o.on("error",n=>{console.error(n)}),o.emit("getTurnUrls",{chat:1})},[]),r.jsx("div",{children:r.jsxs("div",{className:"App",children:[r.jsx("div",{style:{color:"#fff"},children:"Welcome to call beta test!"}),r.jsx("audio",{id:"remoteAudio",autoPlay:!0})]})})}export{g as default};
